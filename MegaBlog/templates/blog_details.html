{% extends 'base.html' %}

{% load static %}
{% block main_body %}

    <!--Main layout-->
    <main class="mt-5 pt-5">
        <div class="container">

            <!--Section: Post-->
            <section class="mt-4">

                <!--Grid row-->
                <div class="row">

                    <!--Grid column-->
                    <div class="col-md-8 mb-4">

                        <!--Featured Image-->
                        <div class="card mb-4 wow fadeIn">
                            <img src="../../media/{{ post.post_thumbnail }}" class="img-fluid" alt="">
                        </div>
                        <!--/.Featured Image-->

                        <!--Card-->
                        <div class="card mb-4 wow fadeIn">

                            <!--Card content-->
                            <div class="card-body text-center">

                                <p class="h5 my-4">What is MDB?</p>

                                <p>MDB is world's most popular Material Design framework for building responsive, mobile-first
                                    websites and apps.</p>

                                <h5 class="my-4">
                                    <strong>MDB - trusted by 400 000 + developers &amp; designers</strong>
                                </h5>

                                <!-- Logo carousel -->
                                <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel" data-interval="1800">
                                    <div class="carousel-inner">
                                        <!-- First slide -->
                                        <div class="carousel-item">
                                            <!--Grid row-->
                                            <div class="row">

                                                <!--First column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/nike.png" class="img-fluid px-4" alt="Nike - logo" style="max-height: 40px">
                                                </div>
                                                <!--/First column-->

                                                <!--Second column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/amazon.png" class="img-fluid px-4" alt="Amazon - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Second column-->

                                                <!--Third column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/sony.png" class="img-fluid px-4" alt="Sony - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Third column-->

                                                <!--Fourth column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/samsung.png" class="img-fluid px-4" alt="Samsung - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Fourth column-->

                                            </div>
                                            <!--/Grid row-->
                                        </div>
                                        <!-- First slide -->

                                        <!-- Second slide -->
                                        <div class="carousel-item active carousel-item-left">
                                            <!--Grid row-->
                                            <div class="row">

                                                <!--First column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/airbus.png" class="img-fluid px-4" alt="Airbus - logo" style="max-height: 40px">
                                                </div>
                                                <!--/First column-->

                                                <!--Second column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/yahoo.png" class="img-fluid px-4" alt="Yahoo - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Second column-->

                                                <!--Third column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/deloitte.png" class="img-fluid px-4" alt="Deloitte - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Third column-->

                                                <!--Fourth column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/ge.png" class="img-fluid px-4" alt="GE - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Fourth column-->

                                            </div>
                                            <!--/Grid row-->
                                        </div>
                                        <!-- Second slide -->

                                        <!-- Third slide -->
                                        <div class="carousel-item carousel-item-next carousel-item-left">
                                            <!--Grid row-->
                                            <div class="row">

                                                <!--First column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/kpmg.png" class="img-fluid px-4" alt="KPMG - logo" style="max-height: 40px">
                                                </div>
                                                <!--/First column-->

                                                <!--Second column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/unity.png" class="img-fluid px-4" alt="Unity - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Second column-->

                                                <!--Third column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/ikea.png" class="img-fluid px-4" alt="Ikea - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Third column-->

                                                <!--Fourth column-->
                                                <div class="col-lg-3 col-md-6 d-flex align-items-center justify-content-center">
                                                    <img src="https://mdbootstrap.com/img/logo/brands/aegon.png" class="img-fluid px-4" alt="Aegon - logo" style="max-height: 40px">
                                                </div>
                                                <!--/Fourth column-->

                                            </div>
                                            <!--/Grid row-->
                                        </div>
                                        <!-- Third slide -->
                                    </div>
                                </div>
                                <!-- Logo carousel -->

                                <hr>

                                <a class="btn btn-outline-primary" href="https://mdbootstrap.com/docs/jquery/getting-started/download/" role="button" target="_blank">MDB free download<i class="fas fa-download ml-2"></i></a>

                            </div>

                        </div>
                        <!--/.Card-->

                        <!--Card-->
                        <div class="card mb-4 wow fadeIn">

                            <!--Card content-->
                            <div class="card-body">

                                <p class="h5 my-4">{{ post.post_title}}  </p>


                                <blockquote class="blockquote">
                                    
                                    <footer class="blockquote-footer">
                                        {{ post.post_brief }}
                                    </footer>
                                </blockquote>

                                <p class="h5 my-4">{{ post.post_title }} </p>

                                <p>{{ post.post_content }}</p>
                                <p>
                                    {% if post.post_images %}                                    
                                    <div class="row">                                        
                                        <div class="col-md-12">

                                            <!--Carousel Wrapper-->
                                            <div id="carousel-example-1z" class="carousel slide" data-ride="carousel">
                                            <!--Indicators-->
                                            <ol class="carousel-indicators">
                                                <li data-target="#carousel-example-1z" data-slide-to="0" class="active"></li>
                                                <li data-target="#carousel-example-1z" data-slide-to="1"></li>
                                                <li data-target="#carousel-example-1z" data-slide-to="2"></li>
                                            </ol>
                                            <!--/.Indicators-->
                                            <p class="blockquote-footer bold">Photos</p>
                                            <!--Slides-->
                                            <div class="carousel-inner" role="listbox">
                                                <!--First slide-->
                                                <div class="carousel-item active">
                                                <img class="d-block w-100" src="../../media/{{ post.post_images }}"
                                                    alt="First slide">
                                                </div>
                                                <!--/First slide-->
                                                <!--Second slide-->
                                                <div class="carousel-item">
                                                <img class="d-block w-100" src="../../media/{{ post.post_images }}">
                                                </div>
                                                <!--/Second slide-->
                                                <!--Third slide-->
                                                <div class="carousel-item">
                                                <img class="d-block w-100" src="../../media/{{ post.post_images }}"
                                                    alt="Third slide">
                                                </div>
                                                <!--/Third slide-->
                                            </div>
                                            <!--/.Slides-->
                                            <!--Controls-->
                                            <a class="carousel-control-prev" href="#carousel-example-1z" role="button" data-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                            <a class="carousel-control-next" href="#carousel-example-1z" role="button" data-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="sr-only">Next</span>
                                            </a>
                                            <!--/.Controls-->
                                            </div>
                                            <!--/.Carousel Wrapper-->

                                        </div>
                                        </div>

                                    {% endif %}

                                    <!--
                                    <p class="blockquote-footer">No photos for this post </p>                                
                                    -->                                                               

                                </p>                             
                                <p>
                                    {% if post.post_videos  %}
                                        <!--Slides-->
                                        <p class="blockquote-footer">Videos</p>
                                        <div class="carousel-inner" role="listbox">
                                            <div class="carousel-item active">                                            
                                                <div class="embed-responsive embed-responsive-16by9 ">
                                                    <iframe class="embed-responsive-item d-block w-100" src="../../media/{{ post.post_videos }}"></iframe>
                                                </div>                                                
                                            </div>                                                                        
                                        </div>
                                        <!--/.Slides-->
                                    {% endif %}
                                    <!--
                                    <p class="blockquote-footer">No videos for this post </p>                                
                                    -->
                                </p>  
                            </div>

                        </div>
                        <!--/.Card-->

                        <!--Card-->
                        <div class="card mb-4 wow fadeIn">

                            <div class="card-header font-weight-bold">
                                <span>About author</span>
                                <span class="pull-right">
                                    <a href="">
                                        <i class="fa fa-facebook-f mr-2"></i>
                                    </a>
                                    <a href="">
                                        <i class="fa fa-twitter mr-2"></i>
                                    </a>
                                    <a href="">
                                        <i class="fa fa-instagram mr-2"></i>
                                    </a>
                                    <a href="">
                                        <i class="fa fa-linkedin-in mr-2"></i>
                                    </a>
                                </span>
                            </div>

                            <!--Card content-->
                            <div class="card-body">

                                <div class="media d-block d-md-flex mt-3">
                                    <img class="d-flex mb-3 mx-auto z-depth-1" src="{% static "img/ethical.jpg" %}" alt="Generic placeholder image"
                                        style="width: 100px;">
                                    <div class="media-body text-center text-md-left ml-md-3 ml-0">
                                        <h5 class="mt-0 font-weight-bold">Fred K. Dunyo
                                        </h5>
                                        Passionate Data Scientist and a big time tech news lover.
                                    </div>
                                </div>

                            </div>

                        </div>
                        <!--/.Card-->

                        <!--Comments-->
                        <div class="card card-comments mb-3 wow fadeIn">                            
                            <div id="comment_count" class="card-header font-weight-bold"><!--Comment Status --></div>                            
                            
                            <div id='content' class="card-body">                                                                
                                <!-- Quick Reply 
                                Comments fetched with XMLHttpRequest through my comment api will be passed in here
                                -->                                                 
                            </div>
                            
                        </div>
                        <!--/.Comments-->

                        <!--Reply-->
                        <div class="card mb-3 wow fadeIn">
                            <div class="card-header font-weight-bold">Leave a reply</div>
                            <div class="card-body">

                                <!-- Default form reply -->
                                <form id="CommentID" action="/blog/{{ post.slug }}/" method="post">
                                    {% csrf_token %}
                                    <!-- Comment -->
                                    <div class="form-group">
                                        <label for="replyFormComment">Your comment</label>
                                        {{ form.body }}
                                    </div>

                                    <!-- Name -->
                                    <label for="replyFormName">Your name</label>
                                    {{ form.author }}

                                    <br>
                            
                                    <div class="text-center mt-4">
                                        <button class="btn btn-info btn-md" type="submit">Post</button>
                                    </div>
                                </form>
                                <!-- Default form reply -->



                            </div>
                        </div>
                        <!--/.Reply-->

                    </div>
                    <!--Grid column-->

                    <!--Grid column-->
                    <div class="col-md-4 mb-4">

                        <!--Card: Jumbotron-->
                        <div class="card blue-gradient mb-4 wow fadeIn">

                            <!-- Content -->
                            <div class="card-body text-white text-center">

                                <h4 class="mb-4">
                                    <strong>Learn Bootstrap 4 with MDB</strong>
                                </h4>
                                <p>
                                    <strong>Best & free guide of responsive web design</strong>
                                </p>
                                <p class="mb-4">
                                    <strong>The most comprehensive tutorial for the Bootstrap 4. Loved by over 500 000 users. Video
                                        and written versions available. Create your own, stunning website.</strong>
                                </p>
                                <a target="_blank" href="https://mdbootstrap.com/education/bootstrap/" class="btn btn-outline-white btn-md">Start free tutorial
                                    <i class="fas fa-graduation-cap ml-2"></i>
                                </a>

                            </div>
                            <!-- Content -->
                        </div>
                        <!--Card: Jumbotron-->

                        <!--Card : Dynamic content wrapper-->
                        <div class="card mb-4 text-center wow fadeIn">

                            <div class="card-header">Do you want to get informed about new articles?</div>

                            <!--Card content-->
                            <div class="card-body">

                                <!-- Default form login -->
                                <form>

                                    <!-- Default input email -->
                                    <label for="defaultFormEmailEx" class="grey-text">Your email</label>
                                    <input type="email" id="defaultFormLoginEmailEx" class="form-control">

                                    <br>

                                    <!-- Default input password -->
                                    <label for="defaultFormNameEx" class="grey-text">Your name</label>
                                    <input type="text" id="defaultFormNameEx" class="form-control">

                                    <div class="text-center mt-4">
                                        <button class="btn btn-info btn-md" type="submit">Sign up</button>
                                    </div>
                                </form>
                                <!-- Default form login -->

                            </div>

                        </div>
                        <!--/.Card : Dynamic content wrapper-->

                        <!--Card-->
                        <div class="card mb-4 wow fadeIn">

                            <div class="card-header">Related articles</div>


                            <!--Card content-->                            
                            <div class="card-body">
                                <ul class="list-unstyled">   
                                {% for related_post in related_posts %}                             
                                    <li class="media">
                                        <img class="d-flex mr-3 img-fluid" src="../../media/{{related_post.post_thumbnail}}" alt="Generic placeholder image">
                                        <div class="media-body">
                                            <a href="../{{related_post.slug}}">
                                                <h5 class="mt-0 mb-1 font-weight-bold">{{related_post.post_title}}</h5>
                                            </a>
                                            {{related_post.post_brief}}
                                        </div>
                                    </li>                                                                                                             
                                {% endfor %}
                                </ul>
                            </div>                            

                        </div>
                        <!--/.Card-->

                    </div>
                    <!--Grid column-->

                </div>
                <!--Grid row-->

            </section>
            <!--Section: Post-->

        </div>
    </main>
    <!--Main layout-->
{% endblock main_body %}

{% block footer %}
    <!--Footer-->
    <footer class="page-footer text-center font-small mdb-color darken-2 mt-4 wow fadeIn">

        <!--Call to action-->
        <div class="pt-4">
            <a class="btn btn-outline-white" href="https://mdbootstrap.com/docs/jquery/getting-started/download/" target="_blank" role="button">Download MDB
                <i class="fas fa-download ml-2"></i>
            </a>
            <a class="btn btn-outline-white" href="https://mdbootstrap.com/education/bootstrap/" target="_blank" role="button">Start free tutorial
                <i class="fas fa-graduation-cap ml-2"></i>
            </a>
        </div>
        <!--/.Call to action-->

        <hr class="my-4">

        <!-- Social icons -->
        <div class="pb-4">
            <a href="https://www.facebook.com/mdbootstrap" target="_blank">
                <i class="fab fa-facebook-f mr-3"></i>
            </a>

            <a href="https://twitter.com/MDBootstrap" target="_blank">
                <i class="fab fa-twitter mr-3"></i>
            </a>

            <a href="https://www.youtube.com/watch?v=7MUISDJ5ZZ4" target="_blank">
                <i class="fab fa-youtube mr-3"></i>
            </a>

            <a href="https://plus.google.com/u/0/b/107863090883699620484" target="_blank">
                <i class="fab fa-google-plus-g mr-3"></i>
            </a>

            <a href="https://dribbble.com/mdbootstrap" target="_blank">
                <i class="fab fa-dribbble mr-3"></i>
            </a>

            <a href="https://pinterest.com/mdbootstrap" target="_blank">
                <i class="fab fa-pinterest mr-3"></i>
            </a>

            <a href="https://github.com/mdbootstrap/bootstrap-material-design" target="_blank">
                <i class="fab fa-github mr-3"></i>
            </a>

            <a href="http://codepen.io/mdbootstrap/" target="_blank">
                <i class="fab fa-codepen mr-3"></i>
            </a>
        </div>
        <!-- Social icons -->

        <!--Copyright-->
        <div class="footer-copyright py-3">
            © 2018 Copyright:
            <a href="https://mdbootstrap.com/education/bootstrap/" target="_blank"> MDBootstrap.com </a>
        </div>
        <!--/.Copyright-->

    </footer>
    <!--/.Footer-->
    {% endblock footer %}

    {% block javascript %}
    <script>
       $(document).ready(function () {                    
        $comment_cnt = $('#comment_count');
        $comment_cnt.html("{{number_of_commments}}"+" Comments");

        $comments_element = $('#content');
        
        function addComment(comment) {
            $comments_element.append("<div class='media d-block d-md-flex mt-3'><img style='width:56px; height: 56px;' class='d-flex mb-3 mx-auto' src='{% static 'img/sample.jpg'%}' alt='Generic placeholder image'><div class='media-body text-center text-md-left ml-md-3 ml-0'><h5 class='mt-0 font-weight-bold'>" + comment.author + "</h5><p>" + comment.body + "</p></div><p class='blockquote-footer'>" + comment.created_on + "</p></div>");
        }
        //Grab and show post's comments
        console.log('{% url "all-comments-api" %}');
        $.ajax({            
            url: '{% url "all-comments-api" %}',
            type: 'GET',
            dataType: 'json',            
            success: function(resp) {
                $.each(resp, function(i, comment) {
                addComment(comment);
            });
            },
            error: function () {
                alert("Error getting comments for this blog post.")
            }
        })

        //On posting new comments, handle it with ajax and append to previous on webpage
        $("#CommentID").submit(function(e) {
            e.preventDefault();          

            $.ajax({
                type: 'POST',
                url: '{% url "all-comments-api" %}',
                data: {author: $(".authorForm").val(),
                        body:   $(".bodyForm").val(),
                        post:   '{{post.id}}',
                        csrfmiddlewaretoken: "{{ csrf_token }}",
                        },
                success: function(resp) {
                    $("#CommentID").trigger("reset");
                    addComment(resp);
                    var num_cmt = parseInt("{{number_of_commments}}");
                    num_cmt += 1;
                    $comment_cnt.html(num_cmt+" Comments");
                },
                error: function () {
                    alert("Error making a post request.");
                }
            });

        });


    });

    </script>
    <script src="{% static 'js/main.js' %}" ></script>    
    {% endblock javascript %}

